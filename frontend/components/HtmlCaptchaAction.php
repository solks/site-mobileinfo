<?php
namespace frontend\components;

use yii\captcha\CaptchaAction;
use yii\helpers\Html;

class HtmlCaptchaAction extends CaptchaAction
{
    public $map = [
		'a' => [
			[0, 0, 1, 0, 0],
			[0, 1, 0, 1, 0],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 1, 1, 1, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
		],
		'b' => [
			[1, 1, 1, 1, 0],
			[0, 1, 0, 0, 1],
			[0, 1, 0, 0, 1],
			[0, 1, 1, 1, 0],
			[0, 1, 0, 0, 1],
			[0, 1, 0, 0, 1],
			[1, 1, 1, 1, 0],
		],
		'c' => [
			[0, 1, 1, 1, 0],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 1],
			[0, 1, 1, 1, 0],
		],
		'd' => [
			[1, 1, 1, 1, 0],
			[0, 1, 0, 0, 1],
			[0, 1, 0, 0, 1],
			[0, 1, 0, 0, 1],
			[0, 1, 0, 0, 1],
			[0, 1, 0, 0, 1],
			[1, 1, 1, 1, 0],
		],
		'e' => [
			[1, 1, 1, 1, 1],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 1, 1, 1, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 1, 1, 1, 1],
		],
		'f' => [
			[1, 1, 1, 1, 1],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 1, 1, 1, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
		],
		'g' => [
			[0, 1, 1, 1, 0],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 0],
			[1, 0, 1, 1, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[0, 1, 1, 1, 0],
		],
		'h' => [
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 1, 1, 1, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
		],
		'i' => [
			[0, 1, 1, 1, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
			[0, 1, 1, 1, 0],
		],
		'j' => [
			[0, 0, 1, 1, 1],
			[0, 0, 0, 1, 0],
			[0, 0, 0, 1, 0],
			[0, 0, 0, 1, 0],
			[0, 0, 0, 1, 0],
			[1, 0, 0, 1, 0],
			[0, 1, 1, 0, 0],
		],
		'k' => [
			[1, 0, 0, 0, 1],
			[1, 0, 0, 1, 0],
			[1, 0, 1, 0, 0],
			[1, 1, 0, 0, 0],
			[1, 0, 1, 0, 0],
			[1, 0, 0, 1, 0],
			[1, 0, 0, 0, 1],
		],
		'l' => [
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 1, 1, 1, 1],
		],
		'm' => [
			[1, 0, 0, 0, 1],
			[1, 1, 0, 1, 1],
			[1, 0, 1, 0, 1],
			[1, 0, 1, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
		],
		'n' => [
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 1, 0, 0, 1],
			[1, 0, 1, 0, 1],
			[1, 0, 0, 1, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
		],
		'o' => [
			[0, 1, 1, 1, 0],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[0, 1, 1, 1, 0],
		],
		'p' => [
			[1, 1, 1, 1, 0],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 1, 1, 1, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 0, 0, 0, 0],
		],
		'q' => [
			[0, 1, 1, 1, 0],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 1, 0, 1],
			[1, 0, 0, 1, 0],
			[0, 1, 1, 0, 1],
		],
		'r' => [
			[1, 1, 1, 1, 0],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 1, 1, 1, 0],
			[1, 0, 1, 0, 0],
			[1, 0, 0, 1, 0],
			[1, 0, 0, 0, 1],
		],
		's' => [
			[0, 1, 1, 1, 0],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 0],
			[0, 1, 1, 1, 0],
			[0, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[0, 1, 1, 1, 0],
		],
		't' => [
			[1, 1, 1, 1, 1],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
		],
		'u' => [
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[0, 1, 1, 1, 0],
		],
		'v' => [
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[0, 1, 0, 1, 0],
			[0, 1, 0, 1, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
		],
		'w' => [
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 1, 0, 1],
			[1, 0, 1, 0, 1],
			[1, 1, 0, 1, 1],
			[1, 0, 0, 0, 1],
		],
		'x' => [
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[0, 1, 0, 1, 0],
			[0, 0, 1, 0, 0],
			[0, 1, 0, 1, 0],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
		],
		'y' => [
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[1, 0, 0, 0, 1],
			[0, 1, 0, 1, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
			[0, 0, 1, 0, 0],
		],
		'z' => [
			[1, 1, 1, 1, 1],
			[0, 0, 0, 0, 1],
			[0, 0, 0, 1, 0],
			[0, 0, 1, 0, 0],
			[0, 1, 0, 0, 0],
			[1, 0, 0, 0, 0],
			[1, 1, 1, 1, 1],
		],
	];
    
    public function init()
    {
    	//-------
    }

    public function run() {
		$this->renderImage($this->verifyCode);
	}

	protected function renderImage($code) {
		$code = (string)$code;
		$buf = "\n";
		$len = strlen($code);
		
		for($i=0; $i<$len; $i++){
			$buf .= $this->getHtmlSymbol($code[$i])."\n";
		}  
		
		echo Html::tag('div', $buf, ['class' => 'v-code'])."\n";
	}
	
	protected function getHtmlSymbol($symbol) {
		if(!isset($this->map[$symbol])) return false;

		$pointsMap = $this->map[$symbol];
	 
		$buf = '<table class="chr">';
		foreach ($pointsMap as $row){
			$buf.='<tr>';
			foreach ($row as $is_filled){
				if($is_filled)
					$buf.='<td class="fld"> </td>';
				else
					$buf.='<td> </td>';
			}
			$buf.='</tr>';
		}
		$buf.='</table>';
		
		return $buf;
	}
}
